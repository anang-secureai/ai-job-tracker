<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Job Loss Tracker — The Alliance for Secure AI</title>
  <meta name="description" content="Tracking AI-linked job losses since January 2025. A public-interest dashboard by The Alliance for Secure AI." />
  <meta property="og:title" content="AI Job Loss Tracker" />
  <meta property="og:description" content="Tracking AI-linked job losses since January 2025." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@400;600;700;800;900&display=swap" rel="stylesheet" />
<style>
:root {
  --seaweed: #192d17; --gamboge: #e4991b; --rangoon: #181c14;
  --light-gray-green: #709663; --ink-light: #f3f7f1; --ink-mid: #b8c8b1;
  --line-soft: rgba(255,255,255,0.16); --card: rgba(24,28,20,0.72); --card-strong: rgba(24,28,20,0.94);
}
*{box-sizing:border-box}html,body{margin:0;min-height:100%}
body{font-family:"Libre Franklin","Franklin Gothic Medium","Arial Narrow",Arial,sans-serif;color:var(--ink-light);background:radial-gradient(circle at 9% -8%,rgba(112,150,99,0.28),transparent 33%),radial-gradient(circle at 88% 4%,rgba(228,153,27,0.22),transparent 31%),linear-gradient(160deg,var(--seaweed),var(--rangoon))}
.crt-overlay{position:fixed;inset:0;pointer-events:none;z-index:999;mix-blend-mode:soft-light;opacity:0.35;background:repeating-linear-gradient(0deg,rgba(243,247,241,0.08) 0 1px,rgba(24,28,20,0) 1px 3px);animation:crtFlicker 5.4s steps(1,end) infinite}
.crt-overlay::before{content:"";position:absolute;inset:-140% 0;background:linear-gradient(180deg,rgba(243,247,241,0) 0%,rgba(243,247,241,0.06) 48%,rgba(243,247,241,0) 52%);animation:scanSweep 9s linear infinite}
.page{width:min(1120px,94vw);margin:0 auto;padding:2.4rem 0 1rem}
.brand-header{display:flex;align-items:flex-start;gap:1rem;padding-bottom:1.7rem;border-bottom:1px solid var(--line-soft)}
.brand-lockup{display:flex;flex-direction:column;gap:0.35rem}
.brand-logo-full{display:block;width:min(259px,31vw);height:auto}
.brand-subline{margin:0;color:var(--ink-mid);font-size:0.86rem;letter-spacing:0.09em;text-transform:uppercase}
.shield-logo{display:block;flex:0 0 auto}.logo-sm{height:2rem;width:auto}.logo-xs{height:1.2rem;width:auto}
.hero{margin-top:1.7rem}
.hero-grid{display:grid;grid-template-columns:minmax(0,1.15fr) minmax(290px,0.85fr);gap:1.1rem;align-items:start}
.hero-copy{min-width:0}
.eyebrow{margin:0;color:var(--light-gray-green);letter-spacing:0.12em;text-transform:uppercase;font-size:0.78rem;font-weight:700}
.hero h1{margin:0.42rem 0 0;max-width:17ch;font-size:clamp(1.95rem,5vw,4.1rem);line-height:1.02;font-weight:900}
.subtitle{margin:1rem 0 0;max-width:66ch;line-height:1.55;color:var(--ink-mid)}
.last-updated{margin:0.65rem 0 0;font-size:0.78rem;font-weight:700;color:var(--gamboge)}
.trend-panel{position:relative;border-radius:0.86rem;border:1px solid rgba(112,150,99,0.35);background:linear-gradient(180deg,rgba(112,150,99,0.16),rgba(24,28,20,0.5));padding:0.78rem 0.85rem 0.7rem}
.trend-kicker{margin:0;font-size:0.66rem;text-transform:uppercase;letter-spacing:0.12em;color:var(--light-gray-green);font-weight:700}
.trend-panel h2{margin:0.33rem 0 0.55rem;font-size:0.94rem}
#monthlyLossChart{display:block;width:100%;height:200px}
.trend-summary{margin:0.45rem 0 0;color:#d7e2d3;font-size:0.76rem;line-height:1.38}
.chart-tooltip{position:absolute;left:0;top:0;transform:translate(-50%,calc(-100% - 10px));z-index:6;pointer-events:none;white-space:nowrap;padding:0.34rem 0.5rem;border-radius:0.52rem;border:1px solid rgba(228,153,27,0.68);background:rgba(16,21,14,0.95);color:#f2f6f0;font-size:0.72rem;font-weight:700;box-shadow:0 0.5rem 1rem rgba(0,0,0,0.28)}
.chart-point-highlight{position:absolute;left:0;top:0;width:0.7rem;height:0.7rem;border-radius:50%;transform:translate(-50%,-50%);z-index:5;pointer-events:none;border:2px solid #f3f7f1;background:#e4991b;box-shadow:0 0 0 0.2rem rgba(228,153,27,0.28)}
.counter-panel{margin-top:1.6rem;padding:1.2rem;border:1px solid rgba(228,153,27,0.34);border-radius:1rem;background:linear-gradient(180deg,rgba(27,38,25,0.85),rgba(24,28,20,0.85))}
.counter-head{display:flex;align-items:flex-start;gap:1rem}
.counter-title{display:flex;align-items:center;gap:0.7rem}
.counter-title h2{margin:0;font-size:1.12rem}
.counter-title p{margin:0.2rem 0 0;color:var(--ink-mid);font-size:0.87rem}
.flip-counter{display:flex;flex-wrap:nowrap;gap:0.44rem;align-items:center;margin-top:1rem}
.digit{--dh:clamp(2.8rem,6.8vw,4.2rem);--df:clamp(1.35rem,3.8vw,2.25rem);position:relative;width:clamp(2.1rem,4.8vw,3.2rem);height:var(--dh);font-family:"Libre Franklin","Arial Narrow",sans-serif;perspective:300px;transform-style:preserve-3d}
.digit .half{position:absolute;left:0;width:100%;height:50%;overflow:hidden;background:linear-gradient(180deg,#121711,#0f130e);color:#f6f9f4;font-weight:800;font-size:var(--df);font-variant-numeric:tabular-nums}
.digit .top{top:0;border-radius:0.45rem 0.45rem 0.11rem 0.11rem;border-bottom:1px solid rgba(228,153,27,0.36);transform-origin:bottom}
.digit .bottom{bottom:0;border-radius:0.11rem 0.11rem 0.45rem 0.45rem;transform-origin:top}
.digit .flap{position:absolute;left:0;width:100%;height:50%;overflow:hidden;font-weight:800;font-size:var(--df);color:#fff;backface-visibility:hidden;pointer-events:none;visibility:hidden;font-variant-numeric:tabular-nums}
.digit .flap-top{top:0;background:linear-gradient(180deg,#293827,#161f14);border-radius:0.45rem 0.45rem 0.11rem 0.11rem;transform-origin:bottom;transform:rotateX(0deg);z-index:3}
.digit .flap-bottom{bottom:0;background:linear-gradient(180deg,#161f14,#10150f);border-radius:0.11rem 0.11rem 0.45rem 0.45rem;transform-origin:top;transform:rotateX(90deg);z-index:2}
.digit .digit-value{position:absolute;top:0;left:0;width:100%;height:var(--dh);display:flex;align-items:center;justify-content:center;line-height:1;transform:translateY(-0.02em);text-shadow:0 0 0.38rem rgba(243,247,241,0.34),0 0 1rem rgba(112,150,99,0.35)}
.digit .bottom .digit-value,.digit .flap-bottom .digit-value{transform:translateY(calc(-50% - 0.02em))}
.digit.flip .flap-top{visibility:visible;animation:flapTop 0.34s ease-in forwards}
.digit.flip .flap-bottom{visibility:visible;animation:flapBottom 0.34s ease-out 0.34s forwards}
.stats{margin-top:1rem;display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:0.85rem}
.stat-card{border-radius:0.82rem;padding:0.85rem 0.95rem;border:1px solid var(--line-soft);background:var(--card)}
.stat-card h3{margin:0.4rem 0 0;font-size:0.9rem;color:var(--ink-mid)}
.stat-card p{margin:0.42rem 0 0;font-size:clamp(1.35rem,3vw,2rem);font-family:"Libre Franklin","Arial Narrow",sans-serif;font-weight:800}
.method{margin-top:1rem;border-radius:0.82rem;padding:0.95rem;background:rgba(112,150,99,0.16);border-left:4px solid var(--gamboge)}
.method h2{margin:0;font-size:1rem}.method p{margin:0.55rem 0 0;color:#d7e2d3;line-height:1.48}.method p+p{margin-top:0.35rem}
.company-grid-section{margin-top:1.2rem;border:1px solid var(--line-soft);border-radius:1rem;background:var(--card-strong);padding:1rem}
.table-wrap{overflow-x:auto;border:1px solid rgba(255,255,255,0.18);border-radius:0.74rem}
.table-disclaimer{margin:0.6rem 0 0;font-size:0.72rem;color:var(--ink-mid);line-height:1.4;font-style:italic}
table{width:100%;min-width:0;table-layout:fixed;border-collapse:collapse}
thead th{text-align:left;font-size:0.78rem;letter-spacing:0.05em;text-transform:uppercase;color:#d0ddcb;background:rgba(112,150,99,0.2);padding:0.66rem;white-space:normal;overflow-wrap:anywhere}
tbody td{padding:0.66rem;border-top:1px solid rgba(255,255,255,0.09);font-size:0.9rem;color:#edf3eb;vertical-align:top;overflow-wrap:anywhere}
thead th:nth-child(1),tbody td:nth-child(1){width:28%}thead th:nth-child(2),tbody td:nth-child(2){width:14%}thead th:nth-child(3),tbody td:nth-child(3){width:16%}thead th:nth-child(4),tbody td:nth-child(4){width:14%}thead th:nth-child(5),tbody td:nth-child(5){width:14%}thead th:nth-child(6),tbody td:nth-child(6){width:14%}
tbody tr:nth-child(even){background:rgba(255,255,255,0.03)}
.cell-company{font-weight:700}.cell-meta{color:var(--ink-mid);font-size:0.78rem;display:block;margin-top:0.15rem}
.source-link{display:inline-block;margin-top:0.28rem;color:#ffe2b1;font-size:0.74rem;text-decoration:underline}.source-link:hover{color:#fff}
.pct-pill{display:inline-flex;align-items:center;border-radius:999px;padding:0.16rem 0.52rem;background:rgba(228,153,27,0.2);border:1px solid rgba(228,153,27,0.5);font-weight:700}
.stock-pill{display:inline-flex;align-items:center;border-radius:999px;padding:0.16rem 0.52rem;font-weight:700;white-space:nowrap}
.stock-pill.stock-positive{color:#d1f5d1;background:rgba(112,150,99,0.22);border:1px solid rgba(112,150,99,0.58)}
.stock-pill.stock-negative{color:#ffd0c8;background:rgba(188,62,41,0.22);border:1px solid rgba(188,62,41,0.58)}
.stock-pill.stock-neutral{color:#e8ece6;background:rgba(255,255,255,0.12);border:1px solid rgba(255,255,255,0.22)}
.attr-tag{display:inline-block;font-size:0.66rem;font-weight:700;letter-spacing:0.04em;text-transform:uppercase;padding:0.1rem 0.35rem;border-radius:999px}
.attr-tag.explicit{background:rgba(112,150,99,0.24);color:#d4edc9;border:1px solid rgba(112,150,99,0.5)}
.attr-tag.blamed{background:rgba(228,153,27,0.2);color:#f9ddb2;border:1px solid rgba(228,153,27,0.5)}
.attr-tag.mixed{background:rgba(255,255,255,0.08);color:#ccc;border:1px solid rgba(255,255,255,0.2)}
.loading-state{text-align:center;padding:3rem 1rem;color:var(--ink-mid)}
.loading-state .spinner{display:inline-block;width:1.5rem;height:1.5rem;border:2px solid var(--line-soft);border-top-color:var(--gamboge);border-radius:50%;animation:spin 0.8s linear infinite;margin-bottom:0.6rem}
.error-state{text-align:center;padding:2rem 1rem;color:#e88}
.site-footer{margin-top:2rem;padding-top:1.2rem;border-top:1px solid var(--line-soft)}
.footer-inner{display:flex;align-items:center;gap:1rem}
.footer-logo{width:140px;height:auto;opacity:0.6}
.site-footer p{margin:0;color:var(--ink-mid);font-size:0.78rem;line-height:1.45}
.site-footer a{color:var(--gamboge);text-decoration:underline}.site-footer a:hover{color:#fff}
@keyframes flapTop{from{transform:rotateX(0deg)}to{transform:rotateX(-90deg)}}
@keyframes flapBottom{from{transform:rotateX(90deg)}to{transform:rotateX(0deg)}}
@keyframes crtFlicker{0%,7%,38%,66%,100%{opacity:.35}8%,37%{opacity:.31}67%{opacity:.4}}
@keyframes scanSweep{from{transform:translateY(-55%)}to{transform:translateY(55%)}}
@keyframes spin{to{transform:rotate(360deg)}}
@media(max-width:910px){.brand-header{flex-direction:column}.hero-grid{grid-template-columns:1fr}.stats{grid-template-columns:1fr}.counter-head{flex-direction:column}.footer-inner{flex-direction:column;align-items:flex-start}table{table-layout:auto;min-width:720px}}
@media(prefers-reduced-motion:reduce){.crt-overlay,.crt-overlay::before{animation:none!important}}
</style>
</head>
<body>
<main class="page">
  <header class="brand-header">
    <div class="brand-lockup">
      <img class="brand-logo-full" src="/assets/the-alliance-logo-white-1600.png" alt="The Alliance for Secure AI" width="1600" height="583" decoding="async" />
      <p class="brand-subline">AI Job Loss Tracker</p>
    </div>
  </header>
  <section class="hero">
    <div class="hero-grid">
      <div class="hero-copy">
        <p class="eyebrow">U.S. + Global Monitor</p>
        <h1>AI-linked job losses since early 2025</h1>
        <p class="subtitle">This dashboard counts newly reported layoffs where AI is either explicitly cited or credibly blamed as a material factor. Reporting window starts January&nbsp;1,&nbsp;2025. Dataset is curated from public reporting by major outlets.</p>
        <p class="last-updated" id="lastUpdated"></p>
      </div>
      <aside class="trend-panel" aria-labelledby="trendHeading">
        <p class="trend-kicker">Trendline</p>
        <h2 id="trendHeading">Cumulative AI job losses</h2>
        <canvas id="monthlyLossChart" role="img" aria-label="Cumulative AI job losses chart"></canvas>
        <p id="monthlyLossSummary" class="trend-summary">Loading...</p>
      </aside>
    </div>
  </section>
  <section class="counter-panel" aria-labelledby="counter-heading">
    <div class="counter-head">
      <div class="counter-title">
        <img class="shield-logo logo-sm" src="/assets/the-alliance-shield-white-256.png" alt="" aria-hidden="true" width="219" height="256" decoding="async" />
        <div><h2 id="counter-heading">Total AI-linked job losses</h2><p id="asOfText">Loading...</p></div>
      </div>
    </div>
    <div id="flipCounter" class="flip-counter" aria-live="polite"><div class="loading-state"><div class="spinner"></div></div></div>
  </section>
  <section class="stats" aria-label="Regional breakdown">
    <article class="stat-card"><img class="shield-logo logo-xs" src="/assets/the-alliance-shield-white-256.png" alt="" aria-hidden="true" width="219" height="256" decoding="async" /><h3>United States</h3><p id="usTotal">—</p></article>
    <article class="stat-card"><img class="shield-logo logo-xs" src="/assets/the-alliance-shield-white-256.png" alt="" aria-hidden="true" width="219" height="256" decoding="async" /><h3>Outside U.S. / Global</h3><p id="intlTotal">—</p></article>
    <article class="stat-card"><img class="shield-logo logo-xs" src="/assets/the-alliance-shield-white-256.png" alt="" aria-hidden="true" width="219" height="256" decoding="async" /><h3>Counted Reports</h3><p id="countedReports">—</p></article>
  </section>
  <section class="method">
    <h2>Counting method</h2>
    <p><strong>Included:</strong> First-time layoffs where AI was a material factor — either explicitly cited by the company, or identified by credible reporting as a primary driver. <strong>Excluded:</strong> Restated totals, duplicate announcements, and layoffs attributed solely to non-AI factors.</p>
    <p>Each entry is reviewed before inclusion. Baseline: January 1, 2025. Stock figures show change from announcement-day close to most recent close and <strong>do not imply the layoffs caused the stock movement</strong>.</p>
  </section>
  <section class="company-grid-section">
    <div class="table-wrap">
      <table><thead><tr><th>Company</th><th>Jobs lost</th><th>Industry</th><th>Running total</th><th>Workforce impact</th><th>Stock since announcement</th></tr></thead>
      <tbody id="companyGridBody"><tr><td colspan="6" class="loading-state"><div class="spinner"></div><br/>Loading...</td></tr></tbody></table>
    </div>
    <p class="table-disclaimer">Stock data via Stooq daily close history. Figures are directional only. Not all events have stock data available.</p>
  </section>
  <footer class="site-footer">
    <div class="footer-inner">
      <img class="footer-logo" src="/assets/the-alliance-logo-white-1600.png" alt="The Alliance for Secure AI" width="1600" height="583" decoding="async" loading="lazy" />
      <p>A public-interest project by <a href="https://theallianceforai.org" target="_blank" rel="noopener">The Alliance for Secure AI</a>. Data sourced from AP, Reuters, CNBC, and other major outlets.</p>
    </div>
  </footer>
</main>
<div class="crt-overlay" aria-hidden="true"></div>
<script>
const BASELINE=new Date(2025,0,1),COUNTABLE_TYPES=new Set(["NEW"]),COUNTABLE_ATTR=new Set(["EXPLICIT","BLAMED","MIXED"]);
const numFmt=new Intl.NumberFormat("en-US"),pctFmt=new Intl.NumberFormat("en-US",{maximumFractionDigits:2}),compactFmt=new Intl.NumberFormat("en-US",{notation:"compact",maximumFractionDigits:1}),monthLabel=new Intl.DateTimeFormat("en-US",{month:"short",year:"numeric"}),monthTick=new Intl.DateTimeFormat("en-US",{month:"short"}),dateFmt=d=>new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(d);
let counterDigits=[],displayedVal=0,counterAnim=null,chartPoints=[],chartReady=false,resizeTimer=null,counted=[];
window.addEventListener("resize",()=>{if(resizeTimer)clearTimeout(resizeTimer);resizeTimer=setTimeout(()=>{hideTip();renderChart(counted)},150)});
boot();
async function boot(){try{const r=await fetch("/api/reports");const d=await r.json();if(d.ok)render(d.reports);else throw new Error(d.error)}catch(e){console.error(e);document.getElementById("companyGridBody").innerHTML='<tr><td colspan="6" class="error-state">Failed to load data.</td></tr>'}}
function render(reports){const since=reports.filter(r=>parseDate(r.date)>=BASELINE);counted=since.filter(r=>COUNTABLE_TYPES.has(r.lossType)&&COUNTABLE_ATTR.has(r.aiAttribution));const total=counted.reduce((s,r)=>s+n(r.jobsLost),0),us=counted.filter(r=>r.region==="US").reduce((s,r)=>s+n(r.jobsLost),0),intl=counted.filter(r=>r.region!=="US").reduce((s,r)=>s+n(r.jobsLost),0);const latest=counted.reduce((mx,r)=>{const d=parseDate(r.date);return d>mx?d:mx},BASELINE);const now=new Date();setText("asOfText",`As of ${dateFmt(now)} · Latest report: ${counted.length?dateFmt(latest):"none yet"}`);setText("lastUpdated",`Last updated: ${dateFmt(latest)} · ${counted.length} reports tracked`);setText("usTotal","0");setText("intlTotal","0");setText("countedReports","0");renderChart(counted);initChartMouse();counterDigits=createCounter(total);displayedVal=0;updateDigits(0,counterDigits);animateCounter(total,2200);animateText("usTotal",us,2200);animateText("intlTotal",intl,2200);animateText("countedReports",counted.length,1800);buildTable(document.getElementById("companyGridBody"),counted)}
function buildTable(body,reps){const sorted=[...reps].sort((a,b)=>parseDate(a.date)-parseDate(b.date));const run=new Map();const rows=sorted.map(r=>{const p=run.get(r.company)||0;const t=p+n(r.jobsLost);run.set(r.company,t);return{...r,runningTotal:t}}).sort((a,b)=>parseDate(b.date)-parseDate(a.date));body.innerHTML="";if(!rows.length){body.innerHTML='<tr><td colspan="6" class="loading-state">No reports yet.</td></tr>';return}rows.forEach(r=>{const wf=n(r.workforce);const pct=wf>0?(r.runningTotal/wf)*100:null;const tr=document.createElement("tr");const attr=(r.aiAttribution||"EXPLICIT").toLowerCase();const ac=attr==="explicit"?"explicit":attr==="blamed"?"blamed":"mixed";const jobs=`${r.estimate?"~":""}${numFmt.format(n(r.jobsLost))}`;const ph=pct===null?'<span class="pct-pill">n/a</span>':`<span class="pct-pill">${pctFmt.format(pct)}%</span>`;const wt=wf>0?`of ${numFmt.format(wf)}`:"workforce n/a";const sl=esc(r.sourceLabel||inferSrc(r.sourceUrl));const su=safeUrl(r.sourceUrl);const sh=su?`<a class="source-link" href="${su}" target="_blank" rel="noopener">${sl} source</a>`:'';const sd=r.stockDeltaPct;const sc=sd==null?"stock-neutral":sd>=0?"stock-positive":"stock-negative";const st=sd==null?"n/a":`${sd>0?"+":""}${pctFmt.format(sd)}%`;tr.innerHTML=`<td><span class="cell-company">${esc(r.company)}</span><span class="cell-meta">${esc(dateFmt(parseDate(r.date)))} · ${esc(r.country||"Global")}</span>${sh}</td><td>${esc(jobs)}<span class="cell-meta"><span class="attr-tag ${ac}">${esc(attr)}</span></span></td><td>${esc(r.industry||"Unknown")}</td><td>${numFmt.format(r.runningTotal)}</td><td>${ph}<span class="cell-meta">${esc(wt)}</span></td><td><span class="stock-pill ${sc}">${esc(st)}</span></td>`;body.appendChild(tr)})}
function createCounter(target){const el=document.getElementById("flipCounter");const len=Math.max(1,String(target).length);const digits=[];el.innerHTML="";for(let i=0;i<len;i++){const d=document.createElement("div");d.className="digit";d.dataset.value="0";d.innerHTML='<div class="half top"><span class="digit-value">0</span></div><div class="half bottom"><span class="digit-value">0</span></div><div class="flap flap-top"><span class="digit-value">0</span></div><div class="flap flap-bottom"><span class="digit-value">0</span></div>';el.appendChild(d);digits.push(d)}return digits}
function updateDigits(v,d){String(v).padStart(d.length,"0").split("").forEach((c,i)=>flip(d[i],c))}
function flip(d,nx){if(!d)return;const cur=d.dataset.value;if(cur===nx)return;const t=d.querySelector(".top .digit-value"),b=d.querySelector(".bottom .digit-value"),ft=d.querySelector(".flap-top .digit-value"),fb=d.querySelector(".flap-bottom .digit-value"),fbf=d.querySelector(".flap-bottom");if(!t)return;if(d.classList.contains("flip")){d.dataset.pending=nx;return}clr(d);t.textContent=cur;b.textContent=nx;ft.textContent=cur;fb.textContent=nx;d.classList.add("flip");let done=false;const fin=()=>{if(done)return;done=true;clr(d);[t,b,ft,fb].forEach(f=>{if(f)f.textContent=nx});d.dataset.value=nx;d.classList.remove("flip");const p=d.dataset.pending;if(p&&p!==nx){delete d.dataset.pending;flip(d,p)}else delete d.dataset.pending};d._fh=fin;d._ft=setTimeout(fin,760);fbf.addEventListener("animationend",fin,{once:true})}
function clr(d){if(!d)return;const fb=d.querySelector(".flap-bottom");if(fb&&d._fh)fb.removeEventListener("animationend",d._fh);if(d._ft)clearTimeout(d._ft);d._fh=null;d._ft=null}
function animateCounter(target,dur){const start=displayedVal,t0=performance.now();if(counterAnim)cancelAnimationFrame(counterAnim);const step=now=>{const p=Math.min(1,(now-t0)/dur);const v=Math.floor(start+(target-start)*(1-Math.pow(1-p,3)));if(v>displayedVal){displayedVal=v;updateDigits(v,counterDigits)}if(p<1)counterAnim=requestAnimationFrame(step);else{displayedVal=target;updateDigits(target,counterDigits);setTimeout(()=>{String(target).padStart(counterDigits.length,"0").split("").forEach((c,i)=>{const d=counterDigits[i];if(!d)return;clr(d);d.classList.remove("flip");delete d.dataset.pending;d.dataset.value=c;d.querySelectorAll(".digit-value").forEach(f=>f.textContent=c)})},800)}};counterAnim=requestAnimationFrame(step)}
function animateText(id,target,dur){const el=document.getElementById(id);if(!el)return;const t0=performance.now();const step=now=>{const p=Math.min(1,(now-t0)/dur);el.textContent=numFmt.format(Math.floor(target*(1-Math.pow(1-p,3))));if(p<1)requestAnimationFrame(step);else el.textContent=numFmt.format(target)};requestAnimationFrame(step)}
function renderChart(reps){const canvas=document.getElementById("monthlyLossChart");if(!canvas)return;const ctx=canvas.getContext("2d");const dpr=devicePixelRatio||1;const rect=canvas.getBoundingClientRect();canvas.width=rect.width*dpr;canvas.height=rect.height*dpr;ctx.setTransform(dpr,0,0,dpr,0,0);ctx.clearRect(0,0,rect.width,rect.height);const sum=document.getElementById("monthlyLossSummary");if(!reps||!reps.length){if(sum)sum.textContent="No data yet.";chartPoints=[];return}const bm=new Map();reps.forEach(r=>{const d=parseDate(r.date);const k=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}`;bm.set(k,(bm.get(k)||0)+n(r.jobsLost))});const keys=[...bm.keys()].sort();let cum=0;const pts=keys.map(k=>{cum+=bm.get(k);const[y,m]=k.split("-").map(Number);return{date:new Date(y,m-1,1),total:cum}});if(!pts.length){if(sum)sum.textContent="No data yet.";chartPoints=[];return}const pad={top:14,right:12,bottom:22,left:44};const w=rect.width-pad.left-pad.right,h=rect.height-pad.top-pad.bottom;const mx=Math.max(...pts.map(p=>p.total))*1.08;const xS=i=>pad.left+(pts.length===1?w/2:(i/(pts.length-1))*w);const yS=v=>pad.top+h-(v/mx)*h;ctx.strokeStyle="rgba(255,255,255,0.07)";ctx.lineWidth=1;for(let i=0;i<=4;i++){const y=pad.top+(i/4)*h;ctx.beginPath();ctx.moveTo(pad.left,y);ctx.lineTo(pad.left+w,y);ctx.stroke();ctx.fillStyle="rgba(255,255,255,0.35)";ctx.font="600 10px 'Libre Franklin',sans-serif";ctx.textAlign="right";ctx.fillText(compactFmt.format(mx-(i/4)*mx),pad.left-6,y+4)}ctx.textAlign="center";ctx.fillStyle="rgba(255,255,255,0.4)";pts.forEach((p,i)=>ctx.fillText(monthTick.format(p.date),xS(i),rect.height-4));const grad=ctx.createLinearGradient(0,pad.top,0,pad.top+h);grad.addColorStop(0,"rgba(228,153,27,0.28)");grad.addColorStop(1,"rgba(228,153,27,0.02)");ctx.beginPath();ctx.moveTo(xS(0),yS(0));pts.forEach((p,i)=>ctx.lineTo(xS(i),yS(p.total)));ctx.lineTo(xS(pts.length-1),yS(0));ctx.closePath();ctx.fillStyle=grad;ctx.fill();ctx.beginPath();pts.forEach((p,i)=>{const x=xS(i),y=yS(p.total);i===0?ctx.moveTo(x,y):ctx.lineTo(x,y)});ctx.strokeStyle="#e4991b";ctx.lineWidth=2.4;ctx.lineJoin="round";ctx.stroke();pts.forEach((p,i)=>{ctx.beginPath();ctx.arc(xS(i),yS(p.total),3.5,0,Math.PI*2);ctx.fillStyle="#e4991b";ctx.fill();ctx.strokeStyle="#f3f7f1";ctx.lineWidth=1.6;ctx.stroke()});chartPoints=pts.map((p,i)=>({x:xS(i),y:yS(p.total),date:p.date,total:p.total}));if(sum){const last=pts[pts.length-1];sum.textContent=`${numFmt.format(last.total)} cumulative losses through ${monthLabel.format(last.date)}.`}}
function getEl(c){let e=document.querySelector("."+c);if(!e){e=document.createElement("div");e.className=c;e.hidden=true;document.querySelector(".trend-panel")?.appendChild(e)}return e}
function hideTip(){const t=document.querySelector(".chart-tooltip"),m=document.querySelector(".chart-point-highlight");if(t)t.hidden=true;if(m)m.hidden=true}
function initChartMouse(){if(chartReady)return;const c=document.getElementById("monthlyLossChart");if(!c)return;c.addEventListener("pointermove",onChart);c.addEventListener("pointerdown",onChart);c.addEventListener("pointerleave",hideTip);chartReady=true}
function onChart(e){const c=e.currentTarget;if(!c||!chartPoints.length){hideTip();return}const rect=c.getBoundingClientRect(),x=e.clientX-rect.left;if(x<0||x>rect.width){hideTip();return}const near=chartPoints.reduce((b,p)=>Math.abs(p.x-x)<Math.abs(b.x-x)?p:b,chartPoints[0]);const panel=c.closest(".trend-panel"),tip=getEl("chart-tooltip"),dot=getEl("chart-point-highlight");if(!panel)return;tip.textContent=`${monthLabel.format(near.date)}: ${numFmt.format(near.total)}`;tip.hidden=false;const pr=panel.getBoundingClientRect(),hw=tip.offsetWidth/2;tip.style.left=`${Math.min(pr.width-8-hw,Math.max(8+hw,rect.left-pr.left+x))}px`;tip.style.top=`${rect.top-pr.top+near.y}px`;dot.hidden=false;dot.style.left=`${rect.left-pr.left+near.x}px`;dot.style.top=`${rect.top-pr.top+near.y}px`}
function parseDate(v){if(typeof v==="string"){let m=v.match(/^(\d{4})-(\d{2})-(\d{2})/);if(m)return new Date(+m[1],+m[2]-1,+m[3]);m=v.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})/);if(m)return new Date(+m[3],+m[1]-1,+m[2])}const d=new Date(v);return isNaN(d.getTime())?BASELINE:d}
function n(v){const x=Number(v);return isFinite(x)?x:0}
function esc(s){return String(s??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}
function safeUrl(u){if(!u)return"";try{const p=new URL(u,location.href);return/^https?:$/.test(p.protocol)?p.toString():""}catch{return""}}
function inferSrc(u){if(!u)return"Source";try{const h=new URL(u).hostname;if(h.includes("apnews"))return"AP";if(h.includes("cnbc"))return"CNBC";if(h.includes("reuters"))return"Reuters";return h.replace("www.","")}catch{return"Source"}}
function setText(id,t){const el=document.getElementById(id);if(el)el.textContent=t}
</script>
</body>
</html>
